---
title: "Customer Data Analysis"
output: html_notebook
---

We want to analyze our customer data, and better understand them.  Please identify:

```{r setup}
load('exerciseData.rda')
```

A quick test of viewing the data
```{r}
head(arrange(dataset_emails,desc(role)),n=10)
```

* The top 10 countries by active enterprise users
```{r}
library(dplyr)
#many to many
#dataset_emails$country
#dataset_tenants$active_enterprise_users_last_30d

# includes duplicate counts
# country_tenants <- left_join(dataset_relation, dataset_emails, by='email_id') %>%
#     left_join(., dataset_tenants, by='tenant_id') %>%
#     filter(active_enterprise_users_last_30d > 0) %>%
#     group_by(country) %>%
#     summarise(total_enterprise_users = sum(active_enterprise_users_last_30d))
# head(arrange(country_tenants,desc(total_enterprise_users)),n=11)

# sort(unique(dataset_tenants$active_enterprise_users_last_30d))
country_tenants <- left_join(dataset_relation, dataset_tenants, by='tenant_id') %>%
    left_join(., dataset_emails, by='email_id') %>%
    select(tenant_id, country, active_enterprise_users_last_30d) #%>%
country_tenants <- unique(country_tenants) # doesn't remove all duplicates
arrange(country_tenants,desc(active_enterprise_users_last_30d))
```
* The top 10 operating systems by open and total tickets
```{r}
#many to many
#dataset_emails$sperating_system
#dataset_tenants$account_total_tickets
#dataset_tenants$account_open_tickets
```
* The distribution of pageviews per group
```{r}
library(dplyr)
#one to many
#dataset_emails$source_group
#dataset_pageviews$visits
group_pageview <- left_join(dataset_pageviews, dataset_emails, by='email_id') %>%
    select(email_id, visits, source_group) %>%
    group_by(source_group) %>%
    summarise(total_pageviews = sum(visits))


group_pageview <- arrange(group_pageview, -total_pageviews)
group_pageview
top_results <- head(group_pageview, n = 8)
pie(top_results$total_pageviews, top_results$source_group, main="Pie Chart of Groups")
```
* The distribution differences on pageviews per login method
```{r}
#one to many
#dataset_emails$login_method
#dataset_pageviews$visits
```
* What differences do you find between developers and non-developers?
```{r}
#dataset_emails$role
```
* What are the most and least used technologies in tenants?
```{r}
library(stringr)
tech <- as.vector(dataset_tenants$technologies_used)
tech <- tech[tech != ""]
comma_count <- sum(str_count(tech, ", "))
tech_reduced <- matrix(NA , nrow=length(tech) + comma_count, ncol=1, dimnames=list(NULL, c("tech_name")))
index <- 1
for (t in 1:length(tech)){
    if (grepl(", ", tech[t])){
        strings <- strsplit(tech[t], ", ")
        strings <- strings[[1]]
        for (s in 1:length(strings)){
            tech_reduced[index, 1] <- strings[s]
            index <- index + 1
        }
    } else {
        tech_reduced[index, 1] <- tech[t]
        index = index + 1
    }
}
tech_reduced <- as.data.frame(tech_reduced)
frequencies <- as.data.frame(lapply(tech_reduced, table))
head(frequencies[order(frequencies$tech_name.Freq),], n = 5)
head(frequencies[order(-frequencies$tech_name.Freq),], n = 5)
```
* Please mark any inconsistencies you find in the data that you'd research further if you were working at Auth0
```{r}

```
* Create at least 3 visualizations using R which you consider interesting for the provided data
```{r}

```
